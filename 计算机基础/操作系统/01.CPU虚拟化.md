## 进程
### 基本概况
- 定义：运行的程序
- 提供有许多CPU的假象
- 分时机制：一个实体使用一小段时间，另一个实体使用一小段时间
- 组成部分：地址空间和寄存器（程序计数器，栈指针等）

### 进程API
- `create` 创建进程
- `destroy` 销毁进程
- `wait` 等待进程
- `status` 进程状态
- 其他控制：如暂停和恢复

### 进程创建过程
- 将代码和所有静态数据加载到内存中（地址空间）
- 为程序的运行时栈分配内存
- 为程序的堆分配内存
- 其他初始化任务，如I/O相关任务
- 启动程序，OS将CPU控制权转移到进程中，程序开始执行

![进程创建过程](https://gitee.com/ixnzone/img-bed/raw/master/2021/02/22/20210222200528.png)

### 进程状态
- 运行：正在执行指令
- 就绪：准备好执行，不在此时运行
- 阻塞：执行了某种操作，直到其他事件发生时才会准备运行

![进程状态转换](https://gitee.com/ixnzone/img-bed/raw/master/2021/02/22/20210222200847.png)

### 数据结构
```cpp
// the registers xv6 will save and restore
// to stop and subsequently restart a process
struct context {
  int eip;
  int esp;
  int ebx;
  int ecx;
  int edx;
  int esi;
  int edi;
  int ebp;
};

// the different states a process can be in
enum proc_state { UNUSED, EMBRYO, SLEEPING,
                  RUNNABLE, RUNNING, ZOMBIE };

// the information xv6 tracks about each process
// including its register context and state
struct proc {
  char *mem;                   // Start of process memory
  uint sz;                     // Size of process memory
  char *kstack;                // Bottom of kernel stack
                               // for this process
  enum proc_state state;       // Process state
  int pid;                     // Process ID
  struct proc *parent;         // Parent process
  void *chan;                  // If non-zero, sleeping on chan
  int killed;                  // If non-zero, have been killed
  struct file *ofile[NOFILE];  // Open files
  struct inode *cwd;           // Current directory
  struct context context;      // Switch here to run process
  struct trapframe *tf;        // Trap frame for the
                               // current interrupt
};
```

## 进程API
- `fork()` 拷贝父进程，拥有自己的地址空间，寄存器和程序计数器
- `wait()` 延迟自己执行，等待的进程执行完后再接着执行
- `exec()` 执行程序，可以执行与父进程完全不一样的程序
- 其他API，如 `kill()` 发送一个信号`signal`,要求进程睡眠，终止或挂起

## 参考文献
- 操作系统导论